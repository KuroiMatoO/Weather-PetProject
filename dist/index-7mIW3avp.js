(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const _ of a.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function o(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(c){if(c.ep)return;c.ep=!0;const a=o(c);fetch(c.href,a)}})();function Z(t,e,o,r,c,a){r?c>0?t.src="img/Day_rain.png":a>0?t.src="img/Day_snow.png":e>=30&&o==0?t.src="img/Day_cloudy.png":t.src="img/Day.png":c>0&&o>0?t.src="img/Night_rain.png":a>0&&o>0?t.src="img/Night_snow.png":e>=30&&o==0?t.src="img/Night_cloudy.png":t.src="img/Night.png"}function ee(t,e,o,r,c){r>0?t.src="img/Day_rain.png":c>0?t.src="img/Day_snow.png":e<.8*o?t.src="img/Day_cloudy.png":t.src="img/Day.png"}async function F(t,e){const o=`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${t}&longitude=${e}&localityLanguage=en`,r=await fetch(o);if(!r.ok)throw new Error("Location API request failed");return r.json()}async function T(t,e){const o=`https://api.open-meteo.com/v1/forecast?latitude=${t}&longitude=${e}&current=temperature_2m,relative_humidity_2m,is_day,precipitation,rain,snowfall,cloud_cover,pressure_msl,wind_speed_10m&hourly=temperature_2m&daily=temperature_2m_max,sunshine_duration,temperature_2m_min,precipitation_sum,rain_sum,showers_sum,snowfall_sum&wind_speed_unit=ms&forecast_days=16`,r=await fetch(o);if(!r.ok)throw new Error("Weather API request failed");return r.json()}async function R(){try{let t,e;u&&d?(t=await F(u,d),e=await T(u,d)):(t=await F(),e=await T(t.latitude,t.longitude));const o=new Date;console.log(t),console.log(e);const r=String(o.getHours()).padStart(2,"0"),c=String(o.getMinutes()).padStart(2,"0"),a=e.current.cloud_cover,_=e.current.precipitation,x=e.current.is_day,V=e.current.rain,J=e.current.snowfall;let E=document.querySelector("#icon img");E=Z(E,a,_,x,V,J),document.querySelector("#temperature").innerHTML=Math.round(e.current.temperature_2m)+"°",document.querySelector("#time").innerHTML=`${r}:${c}`;const U={month:"long",day:"numeric",weekday:"long"};document.querySelector("#date").innerHTML=new Intl.DateTimeFormat("en-US",U).format(o),document.querySelector("#location").innerHTML=`${t.countryCode}, ${t.city}`,document.querySelector("#wind").innerHTML=`Wind: ${e.current.wind_speed_10m} m/s`,document.querySelector("#humidity").innerHTML=`Humidity: ${e.current.relative_humidity_2m}%`,document.querySelector("#pressure").innerHTML="Pressure: "+Math.round(e.current.pressure_msl*.7500637554)+" mm";let W=document.querySelectorAll(".charts-css th"),G=document.querySelectorAll(".area td .data"),$=document.querySelectorAll(".area td"),w=document.querySelectorAll(".line td"),i=new Date().getHours();for(let l=0;l<10;l++)l==0&&($[l].style.setProperty("--start",`calc(${e.hourly.temperature_2m[i-2]}/45)`),$[l].style.setProperty("--end",`calc(${e.hourly.temperature_2m[i]}/45)`),w[l].style.setProperty("--start",`calc(${e.hourly.temperature_2m[i-2]}/45)`),w[l].style.setProperty("--end",`calc(${e.hourly.temperature_2m[i]}/45)`)),$[l].style.setProperty("--start",`calc(${e.hourly.temperature_2m[i]}/45)`),$[l].style.setProperty("--end",`calc(${e.hourly.temperature_2m[i+2]}/45)`),w[l].style.setProperty("--start",`calc(${e.hourly.temperature_2m[i]}/45)`),w[l].style.setProperty("--end",`calc(${e.hourly.temperature_2m[i+2]}/45)`),l<9&&(G[l].innerHTML=Math.round(e.hourly.temperature_2m[i])+"°",i=i+2);for(let l=0;l<9;l++){let g=new Date(o);g.setHours(o.getHours()+2*l),W[l].innerHTML=`${g.getHours()}:00`}let K=document.querySelectorAll(".daily_date"),z=document.querySelectorAll(".day img"),Q=document.querySelectorAll(".daily_temp"),A=e.daily.sunshine_duration,X=A.reduce((l,g)=>l+g,0)/A.length;for(let l=0;l<7;l++){let g=new Date(o);g.setDate(o.getDate()+l);const Y={month:"long",day:"numeric"};K[l].innerHTML=new Intl.DateTimeFormat("en-US",Y).format(g),ee(z[l],A[l],X,e.daily.rain_sum[l],e.daily.snowfall_sum[l]),Q[l].innerHTML=Math.round((e.daily.temperature_2m_max[l]+e.daily.temperature_2m_min[l])/2)+"°"}}catch(t){console.error(t)}}let u,d;R();let M=document.querySelector(".location"),te=document.querySelector("#change_location_btn"),oe=document.querySelector("#location_header button"),k=document.querySelector("#dark_background"),N=document.querySelector(".tip"),s={},m=document.querySelector("#location_search input"),q=document.querySelector(".search_result"),y=document.querySelectorAll(".result_item"),I=document.querySelectorAll(".search_result .city"),re=document.querySelectorAll(".search_result .flag img"),le=document.querySelectorAll(".search_result .country"),P,n={},D=document.querySelector(".favorite_locations"),f=document.querySelectorAll(".favorite_item"),h=document.querySelectorAll(".favorite_locations .city"),C=document.querySelectorAll(".favorite_locations .flag img"),j=document.querySelectorAll(".favorite_locations .country"),ce=document.querySelectorAll(".add_favorite"),ne=document.querySelectorAll(".remove_favorite"),O=localStorage.length,p,b;function v(){M.className=="location invisible"?(M.className="location",k.style.display="block"):(M.className="location invisible",k.style.display="none")}function H(){let t=Object.keys(n).length;!m.value&&t?(q.className="search_result hidden",D.className="favorite_locations",N.className="tip"):!m.value&&!t?(q.className="search_result hidden",D.className="favorite_locations hidden",N.className="tip"):m.value&&m.value.length>1&&t?(q.className="search_result",D.className="favorite_locations",N.className="tip hidden"):m.value.length>1&&(q.className="search_result",D.className="favorite_locations hidden",N.className="tip hidden")}async function ae(t){const e=`https://geocoding-api.open-meteo.com/v1/search?name=${t}&count=10&language=en&format=json`,o=await fetch(e);if(!o.ok)throw new Error("Location API request failed");return o.json()}async function S(){try{const t=await ae(m.value);if(m.value&&m.value.length>1&&t.results){let o=Object.keys(t.results).length;for(let r=0;r<o&&r<5;r++){s[`loc${r}`]={city:t.results[r].name,country:t.results[r].country,latitude:t.results[r].latitude,longitude:t.results[r].longitude,countryCode:t.results[r].country_code.toLowerCase()},le[r].innerHTML=s[`loc${r}`].country,re[r].src=`https://open-meteo.com/images/country-flags/${s[`loc${r}`].countryCode}.svg`;let c=I[r].childNodes[I[r].childNodes.length-1];if(c.nodeValue=s[`loc${r}`].city,y[r].style.display="flex",r<o-1&&r<4&&(y[r].style.borderBottomLeftRadius="0px",y[r].style.borderBottomRightRadius="0px"),o<5){for(let a=5;a>o;a--)y[a-1].style.display=="flex"&&(y[a-1].style.display="none");r==o-1&&(y[r].style.borderBottomLeftRadius="5px",y[r].style.borderBottomRightRadius="5px")}}H()}let e=Object.keys(n).length;if(console.log("FLDLength = "+e),e==0)H();else{for(let o=0;o<e;o++){h[o].nodeValue=n[`loc${o}`].city,j[o].innerHTML=n[`loc${o}`].country,C[o].src=`https://open-meteo.com/images/country-flags/${n[`loc${o}`].countryCode}.svg`;let r=h[o].childNodes[h[o].childNodes.length-1];if(r.nodeValue=n[`loc${o}`].city,f[o].style.display="flex",o<e-1&&o<2&&(f[o].style.borderBottomLeftRadius="0px",f[o].style.borderBottomRightRadius="0px"),e<3){for(let c=3;c>e;c--)f[c-1].style.display!=="none"&&(f[c-1].style.display="none");o==e-1&&(f[o].style.borderBottomLeftRadius="5px",f[o].style.borderBottomRightRadius="5px")}}H()}}catch(t){console.error(t)}}function ie(t){let e=Object.keys(n).length;if(e<3){n[`loc${e}`]={city:s[`loc${t}`].city,country:s[`loc${t}`].country,latitude:s[`loc${t}`].latitude,longitude:s[`loc${t}`].longitude,countryCode:s[`loc${t}`].countryCode};let o=JSON.stringify(n);localStorage.setItem("fav",o),p=localStorage.getItem("fav"),b=JSON.parse(p),h[e].nodeValue=n[`loc${e}`].city,j[e].innerHTML=n[`loc${e}`].country,C[e].src=`https://open-meteo.com/images/country-flags/${n[`loc${e}`].countryCode}.svg`;let r=h[e].childNodes[h[e].childNodes.length-1];r.nodeValue=n[`loc${e}`].city,S(),L()}else console.log("fav data is 3"),L()}function se(t){delete n[`loc${t}`];const e={};Object.keys(n).sort().forEach((r,c)=>{e[`loc${c}`]=n[r]}),n=e;let o=JSON.stringify(n);localStorage.setItem("fav",o),p=localStorage.getItem("fav"),b=JSON.parse(p),S(),L()}function B(t,e){const o=e.currentTarget;o.classList.contains("favorite_item")?(console.log("Favorite item clicked:",t),u=n[`loc${t}`].latitude,d=n[`loc${t}`].longitude,console.log(u,d)):o.classList.contains("result_item")?(console.log("Search result item clicked:",t),u=s[`loc${t}`].latitude,d=s[`loc${t}`].longitude,console.log(u,d)):console.log("Unknown class clicked:",t),T(u,d),v(),R()}te.addEventListener("click",()=>{S(),L(),v()});oe.addEventListener("click",v);k.addEventListener("click",v);O?(p=localStorage.getItem("fav"),b=JSON.parse(p),n=b):O="0";m.addEventListener("input",()=>{clearTimeout(P),P=setTimeout(S,500)});ce.forEach((t,e)=>{t.addEventListener("click",()=>ie(e))});ne.forEach((t,e)=>{t.addEventListener("click",()=>se(e))});f.forEach((t,e)=>{t.addEventListener("click",o=>{B(e,o)})});y.forEach((t,e)=>{t.addEventListener("click",o=>{B(e,o)})});let ue=document.querySelector("#detect_location");ue.addEventListener("click",de);function de(){u="",d="",T(u,d),v(),R()}S();let me=document.querySelector("#debug #variables"),ye=document.querySelector("#debug #local_storage");function L(){me.innerHTML=JSON.stringify(n),ye.innerHTML=JSON.stringify(localStorage)+" localLength = "+O+" Object.keys(favoriteLocationData).length = "+Object.keys(n).length}L();
