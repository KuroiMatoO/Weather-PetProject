(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const $ of a.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&r($)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();function ye(e,o,t,r,n,a){r?n>0?e.src="img/Day_rain.png":a>0?e.src="img/Day_snow.png":o>=30&&t==0?e.src="img/Day_cloudy.png":e.src="img/Day.png":n>0&&t>0?e.src="img/Night_rain.png":a>0&&t>0?e.src="img/Night_snow.png":o>=30&&t==0?e.src="img/Night_cloudy.png":e.src="img/Night.png"}function ge(e,o,t,r,n){r>0?e.src="img/Day_rain.png":n>0?e.src="img/Day_snow.png":o<.8*t?e.src="img/Day_cloudy.png":e.src="img/Day.png"}async function X(e,o){const t=`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${e}&longitude=${o}&localityLanguage=en`,r=await fetch(t);if(!r.ok)throw new Error("Location API request failed");return r.json()}async function E(e,o){const t=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${o}&current=temperature_2m,relative_humidity_2m,is_day,precipitation,rain,snowfall,cloud_cover,pressure_msl,wind_speed_10m&hourly=temperature_2m&daily=temperature_2m_max,sunshine_duration,temperature_2m_min,precipitation_sum,rain_sum,showers_sum,snowfall_sum&wind_speed_unit=ms&forecast_days=16&timezone=Europe%2FMoscow`,r=await fetch(t);if(!r.ok)throw new Error("Weather API request failed");return r.json()}let g,s;async function x(){try{let T=function(l){return(l-Q)/(se-Q)};var e=T;d&&m?(g=await X(d,m),s=await E(d,m)):(g=await X(),s=await E(g.latitude,g.longitude));const o=new Date;console.log(g),console.log(s);const t=String(o.getHours()).padStart(2,"0"),r=String(o.getMinutes()).padStart(2,"0"),n=s.current.cloud_cover,a=s.current.precipitation,$=s.current.is_day,le=s.current.rain,ne=s.current.snowfall;let J=document.querySelector("#icon img");J=ye(J,n,a,$,le,ne),document.querySelector("#temperature").innerHTML=Math.round(s.current.temperature_2m)+"째",document.querySelector("#time").innerHTML=`${t}:${r}`;const ce={month:"long",day:"numeric",weekday:"long"};document.querySelector("#date").innerHTML=new Intl.DateTimeFormat("en-US",ce).format(o),document.querySelector("#location").innerHTML=`${g.countryCode}, ${g.city}`,document.querySelector("#wind").innerHTML=`Wind: ${s.current.wind_speed_10m} m/s`,document.querySelector("#humidity").innerHTML=`Humidity: ${s.current.relative_humidity_2m}%`,document.querySelector("#pressure").innerHTML="Pressure: "+Math.round(s.current.pressure_msl*.7500637554)+" mm";let ae=document.querySelectorAll(".charts-css th"),U=document.querySelectorAll(".area td .data"),A=document.querySelectorAll(".area td"),H=document.querySelectorAll(".line td"),p=new Date().getHours(),_=s.hourly.temperature_2m,q=[],W=0;for(let l=0;l<20;l++)q.push(_[p+l]),W=Math.round(W+q[l]);console.log("hourlyTemp20h: "+q);let z=Math.max(...q),G=Math.min(...q);const K=(z-G)*.2,Q=G-K,se=z+K;for(let l=0;l<10;l++){let i,v,L,S;l==0?(i=_[p-2],v=_[p],L=T(i),S=T(v),U[l].innerHTML=_[p]+"째",A[l].style.setProperty("--start",L),A[l].style.setProperty("--end",S),H[l].style.setProperty("--start",L),H[l].style.setProperty("--end",S)):(i=_[p+l*2],v=_[p+(l+1)*2],L=T(i),S=T(v),A[l].style.setProperty("--start",L),A[l].style.setProperty("--end",S),H[l].style.setProperty("--start",L),H[l].style.setProperty("--end",S),U[l].innerHTML=i+"째"),console.log("current temp: "+_[p]),console.log(`%c start: ${i}`,"color:#3cd737"),console.log(`%c end: ${v}`,"color:#be3016")}for(let l=0;l<9;l++){let i=new Date(o);i.setHours(o.getHours()+2*l),ae[l].innerHTML=`${i.getHours()}:00`}let ie=document.querySelectorAll(".daily_date"),ue=document.querySelectorAll(".day img"),de=document.querySelectorAll(".daily_temp"),F=s.daily.sunshine_duration,me=F.reduce((l,i)=>l+i,0)/F.length;for(let l=0;l<7;l++){let i=new Date(o);i.setDate(o.getDate()+l);const v={month:"long",day:"numeric"};ie[l].innerHTML=new Intl.DateTimeFormat("en-US",v).format(i),ge(ue[l],F[l],me,s.daily.rain_sum[l],s.daily.snowfall_sum[l]),de[l].innerHTML=Math.round((s.daily.temperature_2m_max[l]+s.daily.temperature_2m_min[l])/2)+"째"}}catch(o){console.error(o)}}let d,m;x();V();let P=document.querySelector(".location"),fe=document.querySelector("#change_location_btn"),he=document.querySelector("#location_header button"),j=document.querySelector("#dark_background"),R=document.querySelector(".tip"),u={},y=document.querySelector("#location_search input"),k=document.querySelector(".search_result"),f=document.querySelectorAll(".result_item"),Y=document.querySelectorAll(".search_result .city"),Z=document.querySelectorAll(".search_result .flag img"),pe=document.querySelectorAll(".search_result .country"),ee,c={},O=document.querySelector(".favorite_locations"),h=document.querySelectorAll(".favorite_item"),w=document.querySelectorAll(".favorite_locations .city"),te=document.querySelectorAll(".favorite_locations .flag img"),oe=document.querySelectorAll(".favorite_locations .country"),_e=document.querySelectorAll(".add_favorite"),ve=document.querySelectorAll(".remove_favorite"),B=localStorage.length,N,I,Le=document.querySelector("#detect_location");function b(){P.className=="location invisible"?(P.className="location",j.style.display="block"):(P.className="location invisible",j.style.display="none")}function C(){let e=Object.keys(c).length;!y.value&&e?(k.className="search_result hidden",O.className="favorite_locations",R.className="tip"):!y.value&&!e?(k.className="search_result hidden",O.className="favorite_locations hidden",R.className="tip"):y.value&&y.value.length>1&&e?(k.className="search_result",O.className="favorite_locations",R.className="tip hidden"):y.value.length>1&&(k.className="search_result",O.className="favorite_locations hidden",R.className="tip hidden")}async function Se(e){const o=`https://geocoding-api.open-meteo.com/v1/search?name=${e}&count=10&language=en&format=json`,t=await fetch(o);if(!t.ok)throw new Error("Location API request failed");return t.json()}async function M(){try{const e=await Se(y.value);if(y.value&&y.value.length>1&&e.results){let t=Object.keys(e.results).length;for(let r=0;r<t&&r<5;r++){console.log(e.results[r]),u[`loc${r}`]={city:e.results[r].name,latitude:e.results[r].latitude,longitude:e.results[r].longitude},e.results[r].country?u[`loc${r}`].country=e.results[r].country:u[`loc${r}`].country="",e.results[r].country_code&&(u[`loc${r}`].countryCode=e.results[r].country_code.toLowerCase()),pe[r].innerHTML=u[`loc${r}`].country,e.results[r].country_code?Z[r].src=`https://open-meteo.com/images/country-flags/${u[`loc${r}`].countryCode}.svg`:Z[r].src="https://open-meteo.com/images/country-flags/united_nations.svg";let n=Y[r].childNodes[Y[r].childNodes.length-1];if(n.nodeValue=u[`loc${r}`].city,f[r].style.display="flex",r<t-1&&r<4&&(f[r].style.borderBottomLeftRadius="0px",f[r].style.borderBottomRightRadius="0px"),t<5){for(let a=5;a>t;a--)f[a-1].style.display=="flex"&&(f[a-1].style.display="none");r==t-1&&(f[r].style.borderBottomLeftRadius="5px",f[r].style.borderBottomRightRadius="5px")}}C()}let o=Object.keys(c).length;if(console.log("FLDLength = "+o),o==0)C();else{for(let t=0;t<o;t++){w[t].nodeValue=c[`loc${t}`].city,oe[t].innerHTML=c[`loc${t}`].country,te[t].src=`https://open-meteo.com/images/country-flags/${c[`loc${t}`].countryCode}.svg`;let r=w[t].childNodes[w[t].childNodes.length-1];if(r.nodeValue=c[`loc${t}`].city,h[t].style.display="flex",t<o-1&&t<2&&(h[t].style.borderBottomLeftRadius="0px",h[t].style.borderBottomRightRadius="0px"),o<3){for(let n=3;n>o;n--)h[n-1].style.display!=="none"&&(h[n-1].style.display="none");t==o-1&&(h[t].style.borderBottomLeftRadius="5px",h[t].style.borderBottomRightRadius="5px")}}C()}}catch(e){console.error(e)}}function we(e){let o=Object.keys(c).length;if(o<3){c[`loc${o}`]={city:u[`loc${e}`].city,country:u[`loc${e}`].country,latitude:u[`loc${e}`].latitude,longitude:u[`loc${e}`].longitude,countryCode:u[`loc${e}`].countryCode};let t=JSON.stringify(c);localStorage.setItem("fav",t),N=localStorage.getItem("fav"),I=JSON.parse(N),w[o].nodeValue=c[`loc${o}`].city,oe[o].innerHTML=c[`loc${o}`].country,te[o].src=`https://open-meteo.com/images/country-flags/${c[`loc${o}`].countryCode}.svg`;let r=w[o].childNodes[w[o].childNodes.length-1];r.nodeValue=c[`loc${o}`].city,M(),D()}else console.log("fav data is 3"),D()}function Ne(e){delete c[`loc${e}`];const o={};Object.keys(c).sort().forEach((r,n)=>{o[`loc${n}`]=c[r]}),c=o;let t=JSON.stringify(c);localStorage.setItem("fav",t),N=localStorage.getItem("fav"),I=JSON.parse(N),M(),D()}function re(e,o){const t=o.currentTarget;t.classList.contains("favorite_item")?(console.log("Favorite item clicked:",e),d=c[`loc${e}`].latitude,m=c[`loc${e}`].longitude,console.log(d,m)):t.classList.contains("result_item")?(console.log("Search result item clicked:",e),d=u[`loc${e}`].latitude,m=u[`loc${e}`].longitude,console.log(d,m)):console.log("Unknown class clicked:",e),E(d,m),b(),x(),V()}function $e(){d="",m="",E(d,m),b(),x(),V()}async function V(){try{let n=function(){g&&s?(clearInterval(e),t.className="loader hidden",r.className="loader_bg hidden"):console.log("something wrong")};var o=n;const t=document.querySelector(".loader"),r=document.querySelector(".loader_bg");t.className="loader",r.className="loader_bg";var e=setInterval(n,1e3)}catch(t){console.error(t)}}fe.addEventListener("click",()=>{M(),D(),b()});he.addEventListener("click",b);j.addEventListener("click",b);B?(N=localStorage.getItem("fav"),I=JSON.parse(N),c=I):B="0";y.addEventListener("input",()=>{clearTimeout(ee),ee=setTimeout(M,500)});_e.forEach((e,o)=>{e.addEventListener("click",()=>we(o))});ve.forEach((e,o)=>{e.addEventListener("click",()=>Ne(o))});h.forEach((e,o)=>{e.addEventListener("click",t=>{re(o,t)})});f.forEach((e,o)=>{e.addEventListener("click",t=>{re(o,t)})});Le.addEventListener("click",$e);M();let qe=document.querySelector("#debug #variables"),Te=document.querySelector("#debug #local_storage");function D(){qe.innerHTML=JSON.stringify(c),Te.innerHTML=JSON.stringify(localStorage)+" localLength = "+B+" Object.keys(favoriteLocationData).length = "+Object.keys(c).length}D();
