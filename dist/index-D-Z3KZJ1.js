(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const T of a.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&r(T)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();function fe(e,o,t,r,n,a){r?n>0?e.src="img/Day_rain.png":a>0?e.src="img/Day_snow.png":o>=30&&t==0?e.src="img/Day_cloudy.png":e.src="img/Day.png":n>0&&t>0?e.src="img/Night_rain.png":a>0&&t>0?e.src="img/Night_snow.png":o>=30&&t==0?e.src="img/Night_cloudy.png":e.src="img/Night.png"}function ge(e,o,t,r,n){r>0?e.src="img/Day_rain.png":n>0?e.src="img/Day_snow.png":o<.8*t?e.src="img/Day_cloudy.png":e.src="img/Day.png"}async function Y(e,o){const t=`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${e}&longitude=${o}&localityLanguage=en`,r=await fetch(t);if(!r.ok)throw new Error("Location API request failed");return r.json()}async function I(e,o){const t=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${o}&current=temperature_2m,relative_humidity_2m,is_day,precipitation,rain,snowfall,cloud_cover,pressure_msl,wind_speed_10m&hourly=temperature_2m&daily=temperature_2m_max,sunshine_duration,temperature_2m_min,precipitation_sum,rain_sum,showers_sum,snowfall_sum&wind_speed_unit=ms&forecast_days=16&timezone=Europe%2FMoscow`,r=await fetch(t);if(!r.ok)throw new Error("Weather API request failed");return r.json()}let p,s;async function V(){try{let b=function(l){return(l-X)/(ie-X)};var e=b;m&&y?(p=await Y(m,y),s=await I(m,y)):(p=await Y(),s=await I(p.latitude,p.longitude));const o=new Date;console.log(p),console.log(s);const t=String(o.getHours()).padStart(2,"0"),r=String(o.getMinutes()).padStart(2,"0"),n=s.current.cloud_cover,a=s.current.precipitation,T=s.current.is_day,ne=s.current.rain,ce=s.current.snowfall;let U=document.querySelector("#icon img");U=fe(U,n,a,T,ne,ce),document.querySelector("#temperature").innerHTML=Math.round(s.current.temperature_2m)+"째",document.querySelector("#time").innerHTML=`${t}:${r}`;const ae={month:"long",day:"numeric",weekday:"long"};document.querySelector("#date").innerHTML=new Intl.DateTimeFormat("en-US",ae).format(o),document.querySelector("#location").innerHTML=`${p.countryCode}, ${p.city}`,document.querySelector("#wind").innerHTML=`Wind: ${s.current.wind_speed_10m} m/s`,document.querySelector("#humidity").innerHTML=`Humidity: ${s.current.relative_humidity_2m}%`,document.querySelector("#pressure").innerHTML="Pressure: "+Math.round(s.current.pressure_msl*.7500637554)+" mm";let se=document.querySelectorAll(".charts-css th"),W=document.querySelectorAll(".area td .data"),h=document.querySelectorAll(".area td"),R=document.querySelectorAll(".line td"),be=document.querySelectorAll(".area td:before"),L=new Date().getHours(),S=s.hourly.temperature_2m,D=[],z=0;for(let l=0;l<20;l++)D.push(S[L+l]),z=Math.round(z+D[l]);console.log("hourlyTemp20h: "+D);let G=Math.max(...D),K=Math.min(...D);const Q=(G-K)*.2,X=K-Q,ie=G+Q;for(let l=0;l<2;l++){let i,f,N,w;if(l==0)i=S[L-2],f=S[L],N=b(i),w=b(f),W[l].innerHTML=S[L]+"째",h[l].style.setProperty("--start",N),h[l].style.setProperty("--end",w),R[l].style.setProperty("--start",N),R[l].style.setProperty("--end",w),i<0?h[l].className="minus":h[l].className="";else for(let d=0;d<9;d++)i=S[L+d*2],f=S[L+(d+1)*2],console.log(d),N=b(i),w=b(f),h[d+1].style.setProperty("--start",N),h[d+1].style.setProperty("--end",w),R[d+1].style.setProperty("--start",N),R[d+1].style.setProperty("--end",w),f<0?h[d+1].className="minus":h[d+1].className="",d<8&&(W[d+1].innerHTML=f+"째");console.log("current temp: "+S[L]),console.log(`%c start: ${i}`,"color:#3cd737"),console.log(`%c end: ${f}`,"color:#be3016")}for(let l=0;l<9;l++){let i=new Date(o);i.setHours(o.getHours()+2*l),se[l].innerHTML=`${i.getHours()}:00`}let ue=document.querySelectorAll(".daily_date"),de=document.querySelectorAll(".day img"),me=document.querySelectorAll(".daily_temp"),P=s.daily.sunshine_duration,ye=P.reduce((l,i)=>l+i,0)/P.length;for(let l=0;l<7;l++){let i=new Date(o);i.setDate(o.getDate()+l);const f={month:"long",day:"numeric"};ue[l].innerHTML=new Intl.DateTimeFormat("en-US",f).format(i),ge(de[l],P[l],ye,s.daily.rain_sum[l],s.daily.snowfall_sum[l]),me[l].innerHTML=Math.round((s.daily.temperature_2m_max[l]+s.daily.temperature_2m_min[l])/2)+"째"}}catch(o){console.error(o)}}let m,y;V();J();let C=document.querySelector(".location"),he=document.querySelector("#change_location_btn"),pe=document.querySelector("#location_header button"),B=document.querySelector("#dark_background"),k=document.querySelector(".tip"),u={},g=document.querySelector("#location_search input"),O=document.querySelector(".search_result"),_=document.querySelectorAll(".result_item"),Z=document.querySelectorAll(".search_result .city"),ee=document.querySelectorAll(".search_result .flag img"),_e=document.querySelectorAll(".search_result .country"),te,c={},E=document.querySelector(".favorite_locations"),v=document.querySelectorAll(".favorite_item"),$=document.querySelectorAll(".favorite_locations .city"),oe=document.querySelectorAll(".favorite_locations .flag img"),re=document.querySelectorAll(".favorite_locations .country"),ve=document.querySelectorAll(".add_favorite"),Le=document.querySelectorAll(".remove_favorite"),x=localStorage.length,q,F,Se=document.querySelector("#detect_location");function A(){C.className=="location invisible"?(C.className="location",B.style.display="block"):(C.className="location invisible",B.style.display="none")}function j(){let e=Object.keys(c).length;!g.value&&e?(O.className="search_result hidden",E.className="favorite_locations",k.className="tip"):!g.value&&!e?(O.className="search_result hidden",E.className="favorite_locations hidden",k.className="tip"):g.value&&g.value.length>1&&e?(O.className="search_result",E.className="favorite_locations",k.className="tip hidden"):g.value.length>1&&(O.className="search_result",E.className="favorite_locations hidden",k.className="tip hidden")}async function Ne(e){const o=`https://geocoding-api.open-meteo.com/v1/search?name=${e}&count=10&language=en&format=json`,t=await fetch(o);if(!t.ok)throw new Error("Location API request failed");return t.json()}async function H(){try{const e=await Ne(g.value);if(g.value&&g.value.length>1&&e.results){let t=Object.keys(e.results).length;for(let r=0;r<t&&r<5;r++){console.log(e.results[r]),u[`loc${r}`]={city:e.results[r].name,latitude:e.results[r].latitude,longitude:e.results[r].longitude},e.results[r].country?u[`loc${r}`].country=e.results[r].country:u[`loc${r}`].country="",e.results[r].country_code&&(u[`loc${r}`].countryCode=e.results[r].country_code.toLowerCase()),_e[r].innerHTML=u[`loc${r}`].country,e.results[r].country_code?ee[r].src=`https://open-meteo.com/images/country-flags/${u[`loc${r}`].countryCode}.svg`:ee[r].src="https://open-meteo.com/images/country-flags/united_nations.svg";let n=Z[r].childNodes[Z[r].childNodes.length-1];if(n.nodeValue=u[`loc${r}`].city,_[r].style.display="flex",r<t-1&&r<4&&(_[r].style.borderBottomLeftRadius="0px",_[r].style.borderBottomRightRadius="0px"),t<5){for(let a=5;a>t;a--)_[a-1].style.display=="flex"&&(_[a-1].style.display="none");r==t-1&&(_[r].style.borderBottomLeftRadius="5px",_[r].style.borderBottomRightRadius="5px")}}j()}let o=Object.keys(c).length;if(console.log("FLDLength = "+o),o==0)j();else{for(let t=0;t<o;t++){$[t].nodeValue=c[`loc${t}`].city,re[t].innerHTML=c[`loc${t}`].country,oe[t].src=`https://open-meteo.com/images/country-flags/${c[`loc${t}`].countryCode}.svg`;let r=$[t].childNodes[$[t].childNodes.length-1];if(r.nodeValue=c[`loc${t}`].city,v[t].style.display="flex",t<o-1&&t<2&&(v[t].style.borderBottomLeftRadius="0px",v[t].style.borderBottomRightRadius="0px"),o<3){for(let n=3;n>o;n--)v[n-1].style.display!=="none"&&(v[n-1].style.display="none");t==o-1&&(v[t].style.borderBottomLeftRadius="5px",v[t].style.borderBottomRightRadius="5px")}}j()}}catch(e){console.error(e)}}function we(e){let o=Object.keys(c).length;if(o<3){c[`loc${o}`]={city:u[`loc${e}`].city,country:u[`loc${e}`].country,latitude:u[`loc${e}`].latitude,longitude:u[`loc${e}`].longitude,countryCode:u[`loc${e}`].countryCode};let t=JSON.stringify(c);localStorage.setItem("fav",t),q=localStorage.getItem("fav"),F=JSON.parse(q),$[o].nodeValue=c[`loc${o}`].city,re[o].innerHTML=c[`loc${o}`].country,oe[o].src=`https://open-meteo.com/images/country-flags/${c[`loc${o}`].countryCode}.svg`;let r=$[o].childNodes[$[o].childNodes.length-1];r.nodeValue=c[`loc${o}`].city,H(),M()}else console.log("fav data is 3"),M()}function $e(e){delete c[`loc${e}`];const o={};Object.keys(c).sort().forEach((r,n)=>{o[`loc${n}`]=c[r]}),c=o;let t=JSON.stringify(c);localStorage.setItem("fav",t),q=localStorage.getItem("fav"),F=JSON.parse(q),H(),M()}function le(e,o){const t=o.currentTarget;t.classList.contains("favorite_item")?(console.log("Favorite item clicked:",e),m=c[`loc${e}`].latitude,y=c[`loc${e}`].longitude,console.log(m,y)):t.classList.contains("result_item")?(console.log("Search result item clicked:",e),m=u[`loc${e}`].latitude,y=u[`loc${e}`].longitude,console.log(m,y)):console.log("Unknown class clicked:",e),I(m,y),A(),V(),J()}function qe(){m="",y="",I(m,y),A(),V(),J()}async function J(){try{let n=function(){p&&s?(clearInterval(e),t.className="loader hidden",r.className="loader_bg hidden"):console.log("something wrong")};var o=n;const t=document.querySelector(".loader"),r=document.querySelector(".loader_bg");t.className="loader",r.className="loader_bg";var e=setInterval(n,1e3)}catch(t){console.error(t)}}he.addEventListener("click",()=>{H(),M(),A()});pe.addEventListener("click",A);B.addEventListener("click",A);x?(q=localStorage.getItem("fav"),F=JSON.parse(q),c=F):x="0";g.addEventListener("input",()=>{clearTimeout(te),te=setTimeout(H,500)});ve.forEach((e,o)=>{e.addEventListener("click",()=>we(o))});Le.forEach((e,o)=>{e.addEventListener("click",()=>$e(o))});v.forEach((e,o)=>{e.addEventListener("click",t=>{le(o,t)})});_.forEach((e,o)=>{e.addEventListener("click",t=>{le(o,t)})});Se.addEventListener("click",qe);H();let Te=document.querySelector("#debug #variables"),De=document.querySelector("#debug #local_storage");function M(){Te.innerHTML=JSON.stringify(c),De.innerHTML=JSON.stringify(localStorage)+" localLength = "+x+" Object.keys(favoriteLocationData).length = "+Object.keys(c).length}M();
